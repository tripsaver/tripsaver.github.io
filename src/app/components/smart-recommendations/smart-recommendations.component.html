<section class="smart-recommendations-section">
  <div class="container">
    <!-- ğŸ“± MOBILE MENU TOGGLE (Show only on mobile) -->
    <div class="mobile-menu-header">
      <button 
        class="hamburger-button"
        (click)="toggleMobileMenu()"
        [class.active]="mobileMenuOpen"
        aria-label="Toggle menu">
        <span class="hamburger-line"></span>
        <span class="hamburger-line"></span>
        <span class="hamburger-line"></span>
      </button>
      <h3 class="mobile-title">ğŸ¤– Trip Finder</h3>
    </div>

    <!-- ğŸ“± MOBILE MENU (Dropdown when opened) -->
    <div class="mobile-menu" *ngIf="mobileMenuOpen">
      <p class="mobile-menu-subtitle">Select your travel preferences</p>
    </div>

    <!-- FILTER SECTION (Only show if showForm is true) -->
    <div class="filters" *ngIf="showForm">
      <h2>ğŸ¤– AI-Powered Destination Finder</h2>
      <p class="subtitle">
        Personalized destination recommendations based on timing, budget, interests, and climate preferences.
      </p>

      <div class="filter-row">
        <div class="filter-group">
          <label for="month">ğŸ“… When are you traveling?</label>
          <select 
            id="month"
            [(ngModel)]="preferences.month" 
            [disabled]="areInputsDisabled()"
            class="form-input">
            <option [value]="1">January</option>
            <option [value]="2">February</option>
            <option [value]="3">March</option>
            <option [value]="4">April</option>
            <option [value]="5">May</option>
            <option [value]="6">June</option>
            <option [value]="7">July</option>
            <option [value]="8">August</option>
            <option [value]="9">September</option>
            <option [value]="10">October</option>
            <option [value]="11">November</option>
            <option [value]="12">December</option>
          </select>
        </div>

        <div class="filter-group">
          <label for="budget">ğŸ’° Budget range</label>
          <select 
            id="budget"
            [(ngModel)]="preferences.budget" 
            [disabled]="areInputsDisabled()"
            class="form-input">
            <option value="budget">Budget (â‚¹10k-20k)</option>
            <option value="moderate">Moderate (â‚¹15k-30k)</option>
            <option value="premium">Premium (â‚¹30k+)</option>
          </select>
        </div>
      </div>

      <div class="filter-group">
        <label>ğŸ¯ What interests you?</label>
        <div class="categories">
          <label *ngFor="let cat of availableCategories" class="category-pill">
            <input 
              type="checkbox" 
              [checked]="preferences.categories.includes(cat)"
              [disabled]="areInputsDisabled()"
              (change)="toggleCategory(cat)">
            <span>{{ cat }}</span>
          </label>
        </div>
      </div>

      <!-- âœ… EXPLICIT ACTION BUTTON -->
      <button 
        (click)="getRecommendations()" 
        [disabled]="isButtonDisabled()"
        class="get-recommendations-btn"
        [class.loading]="uiState.loading">
        {{ getButtonLabel() }}
      </button>
    </div>

    <!-- RESULTS SECTION -->
    <div class="results" *ngIf="!uiState.loading && recommendations.length > 0">
      <!-- Results Title (only show when in results-only mode) -->
      <div *ngIf="!showForm" class="results-header">
        <h2>âœ¨ Smart Recommendations</h2>
        <p class="results-subtitle">Based on your preferences, here are our top recommendations</p>
      </div>
      
      <!-- Results Title (show differently when form is visible) -->
      <div *ngIf="showForm" class="results-header">
        <h3>âœ¨ Recommended for You</h3>
        <p class="results-subtitle">Based on your preferences, here are our top recommendations</p>
      </div>

      <!-- Result Summary - Shows filter criteria -->
      <app-result-summary
        [month]="preferences.month"
        [budget]="preferences.budget"
        [categories]="preferences.categories"
        [resultCount]="recommendations.length">
      </app-result-summary>

      <!-- âœ… CAROUSEL LAYOUT (Single Card with Navigation) -->
      <div class="carousel-container">
        <!-- Previous Button -->
        <button 
          class="nav-button nav-prev"
          (click)="previousCard()"
          [disabled]="currentCardIndex === 0"
          aria-label="Previous recommendation">
          â® Previous
        </button>

        <!-- Single Card Display -->
        <div class="carousel-card">
          <app-destination-card-compact
            *ngIf="recommendations.length > 0"
            [recommendation]="recommendations[currentCardIndex]"
            (bookingClicked)="openBookingModal($event)">
          </app-destination-card-compact>
        </div>

        <!-- Next Button -->
        <button 
          class="nav-button nav-next"
          (click)="nextCard()"
          [disabled]="currentCardIndex === recommendations.length - 1"
          aria-label="Next recommendation">
          Next â¯
        </button>
      </div>

      <!-- Card Counter -->
      <div class="carousel-counter">
        Showing {{ currentCardIndex + 1 }} of {{ recommendations.length }} recommendations
      </div>
    </div>

    <!-- LOADING STATE -->
    <div *ngIf="uiState.loading" class="loading-state">
      <div class="spinner"></div>
      <p>Finding perfect destinations for you...</p>
    </div>

    <!-- NO RESULTS STATE (with smart fallback guidance) -->
    <div *ngIf="hasNoResults()" class="no-results-state">
      <div class="no-results-content">
        <h3>ğŸ˜Š Let's refine your search</h3>
        <p class="no-results-message">{{ getNoResultsMessage() }}</p>
        
        <div class="suggestions">
          <p class="suggestions-title">ğŸ’¡ Try these adjustments:</p>
          <ul>
            <li *ngFor="let suggestion of getSuggestionsForNoResults()">{{ suggestion }}</li>
          </ul>
        </div>

        <button (click)="getRecommendations()" class="retry-button">
          ğŸ” Search Again
        </button>
      </div>
    </div>

    <!-- ERROR STATE -->
    <div *ngIf="uiState.error" class="error-message">
      âš ï¸ {{ uiState.error }}
    </div>

    <!-- EMPTY STATE -->
    <div *ngIf="!uiState.loading && recommendations.length === 0 && !uiState.error && !hasNoResults()" class="empty-state">
      <p>Select your preferences above and click "Get Recommendations" to discover personalized destinations</p>
    </div>
  </div>
</section>

<!-- Booking Modal -->
<app-booking-modal
  [isOpen]="isBookingModalOpen"
  [destinationName]="selectedDestination?.state || ''"
  [agodaCode]="selectedDestination?.agoda || ''"
  (closed)="closeBookingModal()">
</app-booking-modal>
